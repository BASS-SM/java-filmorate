drop table FILMS_LIKES;

drop table FILM_GENRE;

drop table FILMS;

drop table FRIENDSHIP;

drop table GENRES;

drop table MPA;

drop table USERS;
-- DROP TABLE "USERS";
-- DROP TABLE "FRIENDSHIP";
-- DROP TABLE "GENRES";
-- DROP TABLE "MPA";
--
-- DROP TABLE "FILM_GENRE";
-- DROP TABLE "FILMS_LIKES";

CREATE TABLE IF NOT EXISTS "USERS"
(
    id  INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "NAME"     VARCHAR(50) NOT NULL,
    "EMAIL"    VARCHAR(20) NOT NULL,
    "LOGIN"    VARCHAR(50),
    "BIRTHDAY" DATE        NOT NULL
);

CREATE TABLE IF NOT EXISTS "FRIENDSHIP"
(
    "USER_ID"   INTEGER NOT NULL,
    "FRIEND_ID" INTEGER NOT NULL,
    PRIMARY KEY ("USER_ID", "FRIEND_ID")
);

CREATE TABLE IF NOT EXISTS "GENRES"
(
    "GENRE_ID" INTEGER PRIMARY KEY NOT NULL,
    "NAME"     VARCHAR(255)        NOT NULL
);

CREATE TABLE IF NOT EXISTS "MPA"
(
    "MPA_ID" INTEGER PRIMARY KEY NOT NULL,
    "NAME"   VARCHAR(255)        NOT NULL
);

CREATE TABLE IF NOT EXISTS "FILMS"
(
    "FILM_ID"      INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "FILM_NAME"    VARCHAR(255) NOT NULL,
    "DESCRIPTION"  VARCHAR(255) NOT NULL,
    "RELEASE_DATE" DATE         NOT NULL,
    "DURATION"     INT          NOT NULL,
    "MPA_ID"       INT          NOT NULL
);

CREATE TABLE IF NOT EXISTS "FILM_GENRE"
(
    "FILM_ID"  INTEGER NOT NULL,
    "GENRE_ID" INT     NOT NULL,
    PRIMARY KEY ("GENRE_ID", "FILM_ID")
);

CREATE TABLE IF NOT EXISTS "FILMS_LIKES"
(
    "FILM_ID" INTEGER NOT NULL,
    "USER_ID" INTEGER NOT NULL,
    PRIMARY KEY ("USER_ID", "FILM_ID")
);

ALTER TABLE "FRIENDSHIP"
    ADD CONSTRAINT "FK_FRIENDSHIP_FRIEND_ID" FOREIGN KEY ("FRIEND_ID") REFERENCES "USERS" (id) ON DELETE CASCADE;

ALTER TABLE "FRIENDSHIP"
    ADD CONSTRAINT "FK_FRIENDSHIP_USER_ID" FOREIGN KEY ("USER_ID") REFERENCES "USERS" (id) ON DELETE CASCADE;

ALTER TABLE "FILMS"
    ADD CONSTRAINT "FK_MPA_ID" FOREIGN KEY ("MPA_ID") REFERENCES "MPA" ("MPA_ID") ON DELETE RESTRICT;

ALTER TABLE "FILM_GENRE"
    ADD CONSTRAINT "FK_FILM_ID" FOREIGN KEY ("FILM_ID") REFERENCES "FILMS" ("FILM_ID") ON DELETE CASCADE;

ALTER TABLE "FILM_GENRE"
    ADD CONSTRAINT "FK_GENRE_ID" FOREIGN KEY ("GENRE_ID") REFERENCES "GENRES" ("GENRE_ID") ON DELETE CASCADE;

ALTER TABLE "FILMS_LIKES"
    ADD CONSTRAINT "FK_FILMS_LIKES_FILM_ID" FOREIGN KEY ("FILM_ID") REFERENCES "FILMS" ("FILM_ID") ON DELETE CASCADE;

ALTER TABLE "FILMS_LIKES"
    ADD CONSTRAINT "FK_FILMS_LIKES_USER_ID" FOREIGN KEY ("USER_ID") REFERENCES "USERS" (id) ON DELETE CASCADE;
